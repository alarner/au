!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("immutable")):"function"==typeof define&&define.amd?define(["exports","react","immutable"],t):t(e["au-flux"]={},null,null)}(this,function(e,n,f){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var r=function(e){return function(){var u=e.apply(this,arguments);return new Promise(function(a,i){return function t(e,r){try{var n=u[e](r),o=n.value}catch(e){return void i(e)}if(!n.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});a(o)}("next")})}},h=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s=function e(t,r){if(h(this,e),r&&!(r instanceof Function))throw new Error("Second argument to ActionResult constructor must be a function if supplied.");this.immediate=t,this.deferred=r},y={},d=new(function(){function e(){h(this,e),this.componentId=1}return u(e,[{key:"nextComponentId",value:function(){return this.componentId++}}]),e}()),c=function(e){function l(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default";h(this,l);var r=null;r=e instanceof l?e.data:e instanceof Error?f.Map().set("default",e):"string"==typeof e?f.Map().set(t,e):f.Map(e),e="",jsData=r.toJS();var n=!0,o=!1,a=void 0;try{for(var i,u=jsData[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var s=i.value;e+=s+": "+jsData[s]+"\n"}}catch(e){o=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}var c=v(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e));return c.data=r,c}return a(l,e),u(l,[{key:"toJS",value:function(){return this.data.toJS()}}]),l}(Error);function t(){var _=[],A=[],C=null;this.subscribe=function(e){if(!e||!e.isStore)throw new Error("Dispatcher.subscribe requires a store.");_.push(e)},this.trigger=function(r){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=_.filter(function(e){return e.canHandleAction(r)});if(!e.length)throw new Error('There are no handlers for action "'+r+'"');var o=e.map(function(e){return D(e,r,n,e.state())}),t=null;o.some(function(e){return e.error})&&(t=!1),o.some(function(e){return e.deferred})||0!==A.length||(t=!0);var a=!0,i=!1,u=void 0;try{for(var s,c=o[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value;l.error?l.store.setError(l.error):(l.store.setState(l.state,!1),!0===t&&l.store.setState(l.state,!0)),l.store.triggerStateChange()}}catch(e){i=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(i)throw u}}return null!==t?(A.length&&A.push({name:r,data:n,results:o,resolve:null,reject:null}),t):new Promise(function(e,t){A.push({name:r,data:n,results:o,resolve:e,reject:t}),R()})};var t,R=function(){C||(C=A.shift())&&e(C)},e=(t=r(regeneratorRuntime.mark(function e(t){var r,n,c,o,a,i,u,s,l,f,h,v,y,d,p,m,b,w,k,g,S,x,O,P=t.name,j=t.results,E=t.resolve;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.filter(function(e){return e.canHandleAction(P)}),e.next=3,Promise.all(j.map(T));case 3:for(n=e.sent,c={},a=!(o=!0),i=void 0,e.prev=8,u=n[Symbol.iterator]();!(o=(s=u.next()).done);o=!0)f=(l=s.value).state,h=l.error,c[(v=l.store).key()]={clean:f,error:h,dirty:f,store:v},v.setState(f,!0);e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),a=!0,i=e.t0;case 16:e.prev=16,e.prev=17,!o&&u.return&&u.return();case 19:if(e.prev=19,!a){e.next=22;break}throw i;case 22:return e.finish(19);case 23:return e.finish(16);case 24:for(d=!(y=!0),p=void 0,e.prev=27,m=function(){var t=w.value,e=_.filter(function(e){return e.canHandleAction(t.name)}).map(function(e){return D(e,t.name,t.data,e.state())}),r=!0,n=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var u=a.value,s=u.store.key();c.hasOwnProperty(s)&&(c[s].dirty=u.state)}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}},b=A[Symbol.iterator]();!(y=(w=b.next()).done);y=!0)m();e.next=36;break;case 32:e.prev=32,e.t1=e.catch(27),d=!0,p=e.t1;case 36:e.prev=36,e.prev=37,!y&&b.return&&b.return();case 39:if(e.prev=39,!d){e.next=42;break}throw p;case 42:return e.finish(39);case 43:return e.finish(36);case 44:for(g in k=!1,c)v=(S=c[g]).store,x=S.clean,O=S.dirty,(h=S.error)?(k=!0,v.setError(h)):(v.setState(x,!0),v.setState(O,!1)),v.triggerStateChange();E(!k),C=null,R(r);case 49:case"end":return e.stop()}},e,this,[[8,12,16,24],[17,,19,23],[27,32,36,44],[37,,39,43]])})),function(e){return t.apply(this,arguments)})}var i,D=function(e,t,r,n){var o=null,a=null;try{var i=e.handleAction(t,r,n);i instanceof s?(n=i.immediate,a=i.deferred):n=i}catch(e){if(!(e instanceof c))throw e;o=e}return{state:n,error:o,deferred:a,store:e}},T=(i=r(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=null,e.prev=2,!t.deferred){e.next=7;break}return e.next=6,t.deferred();case 6:r=e.sent;case 7:e.next=16;break;case 9:if(e.prev=9,e.t0=e.catch(2),!(e.t0 instanceof c)){e.next=15;break}n=e.t0,e.next=16;break;case 15:throw e.t0;case 16:return e.abrupt("return",{state:r,error:n,store:t.store});case 17:case"end":return e.stop()}},e,void 0,[[2,9]])})),function(e){return i.apply(this,arguments)}),l=new t;e.ActionResult=s,e.buildSmartComponent=function(c){for(var e=arguments.length,l=Array(1<e?e-1:0),t=1;t<e;t++)l[t-1]=arguments[t];return function(e){function s(e){h(this,s);var t=v(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));t.state={},t.key=d.nextComponentId();var r=!0,n=!1,o=void 0;try{for(var a,i=l[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var u=a.value;if(!y.hasOwnProperty(u))throw new Error('Cannot connect component "'+c.name+'" to non-existant store "'+u+'"');y[u].connectToState(t.key,t.setState.bind(t)),t.state[u]=y[u].fullState()}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}return t}return a(s,n.Component),u(s,[{key:"componentWillUnmount",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,o=l[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)l[n.value].ignore(this.key)}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}},{key:"render",value:function(){var e={},t={};for(var r in this.state)e[r]=this.state[r].errors,t[r]=this.state[r].value;return n.createElement(c,o({errors:e},t,this.props))}}]),s}()},e.buildStore=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:l,r=null,o={clean:null,dirty:null},a=[],i={};return function(){function t(e){h(this,t),this.isStore=!0,o.clean=e,o.dirty=e}return u(t,[{key:"setKey",value:function(e){r=e}},{key:"key",value:function(){return r}},{key:"setState",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];o[t?"clean":"dirty"]=e,t&&(o.dirty=e),{}[this.key()]=o.dirty}},{key:"state",value:function(){return o[0<arguments.length&&void 0!==arguments[0]&&arguments[0]?"clean":"dirty"]}},{key:"fullState",value:function(){return{value:this.state(0<arguments.length&&void 0!==arguments[0]&&arguments[0]),errors:i}}},{key:"setError",value:function(e){i=e.toJS()}},{key:"triggerStateChange",value:function(){var r={};return r[this.key()]=this.fullState(),Promise.all(a.map(function(t){return new Promise(function(e){return t.setState(r,e)})}))}},{key:"dispatcher",value:function(){return e}},{key:"canHandleAction",value:function(e){return n.hasOwnProperty(e)}},{key:"handleAction",value:function(e,t,r){return n[e].call(this,r,t)}},{key:"connectToState",value:function(t,e){if(a.some(function(e){return e.key===t}))throw new Error("component (key="+t+") is already listening to the store (key="+this.key()+")");a.push({key:t,setState:e})}},{key:"ignore",value:function(t){a=a.filter(function(e){return e.key!==t})}}]),t}()},e.d=l,e.Dispatcher=t,e.init=function(e){for(var t in e){var r=e[t];r.setKey(t),r.dispatcher().subscribe(r),y[t]=r}},e.RecoverableError=c,e.stores=y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=bundle.umd.js.map
