!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e["au-flux"]={})}(this,function(e){"use strict";var r=function(e){return function(){var u=e.apply(this,arguments);return new Promise(function(a,i){return function t(e,r){try{var n=u[e](r),o=n.value}catch(e){return void i(e)}if(!n.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});a(o)}("next")})}},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),c=function e(t,r){if(i(this,e),r&&!(r instanceof Function))throw new Error("Second argument to ActionResult constructor must be a function if supplied.");this.immediate=t,this.deferred=r};function t(){var t,C=[],Q=[],e=null;this.subscribe=function(e){if(!e||!e.isStore)throw new Error("");C.push(e)},this.trigger=function(r){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=C.filter(function(e){return e.canHandleAction(r)});if(!e.length)throw new Error('There are no handlers for action "'+action+'"');var o=e.map(function(e){return H(e,r,n,e.state())}),t=!0,a=!1,i=void 0;try{for(var u,c=o[Symbol.iterator]();!(t=(u=c.next()).done);t=!0){var s=u.value;s.error?s.store.setError(s.error,!1):s.store.setState(s.state,!1,!1),s.store.triggerStateChange()}}catch(e){a=!0,i=e}finally{try{!t&&c.return&&c.return()}finally{if(a)throw i}}var f=null;return o.some(function(e){return e.error})&&(f=!1),o.some(function(e){return e.deferred})||(f=!0),null!==f?(Q.length&&Q.push({name:r,data:n,results:o,resolve:null,reject:null}),f):new Promise(function(e,t){Q.push({name:r,data:n,results:o,resolve:e,reject:t}),attemptNextActionFromQueue(C)})},this.attemptNextActionFromQueue=function(){e||(e=Q.shift())&&this.processActionFromQueue(e,C)},this.processActionFromQueue=(t=r(regeneratorRuntime.mark(function e(t){var r,n,s,o,a,i,u,c,f,l,h,v,d,p,y,m,k,g,b,w,x,S,A,P,E,F,R=t.name,j=t.results;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=C.filter(function(e){return e.canHandleAction(R)}),e.next=3,Promise.all(j.map(O));case 3:for(n=e.sent,s={},a=!(o=!0),i=void 0,e.prev=8,u=n[Symbol.iterator]();!(o=(c=u.next()).done);o=!0)l=(f=c.value).state,h=f.error,s[(v=f.store).key()]={clean:l,error:h,dirty:l,store:v};e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),a=!0,i=e.t0;case 16:e.prev=16,e.prev=17,!o&&u.return&&u.return();case 19:if(e.prev=19,!a){e.next=22;break}throw i;case 22:return e.finish(19);case 23:return e.finish(16);case 24:for(p=!(d=!0),y=void 0,e.prev=27,m=function(){var t=g.value,e=C.filter(function(e){return e.canHandleAction(t.name)}).map(function(e){return H(e,t.name,t.data,e.state())}),r=!0,n=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var u=a.value,c=u.store.key();s.hasOwnProperty(c)&&(s[c].dirty=u.state)}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}},k=Q[Symbol.iterator]();!(d=(g=k.next()).done);d=!0)m();e.next=36;break;case 32:e.prev=32,e.t1=e.catch(27),p=!0,y=e.t1;case 36:e.prev=36,e.prev=37,!d&&k.return&&k.return();case 39:if(e.prev=39,!p){e.next=42;break}throw y;case 42:return e.finish(39);case 43:return e.finish(36);case 44:for(w=!(b=!0),x=void 0,e.prev=47,S=s[Symbol.iterator]();!(b=(A=S.next()).done);b=!0)v=(P=s[A.value]).store,E=P.clean,F=P.dirty,(h=P.error)?v.setError(h,!1):(v.setState(E,!0,!1),v.setState(F,!1,!1)),v.triggerStateChange();e.next=55;break;case 51:e.prev=51,e.t2=e.catch(47),w=!0,x=e.t2;case 55:e.prev=55,e.prev=56,!b&&S.return&&S.return();case 58:if(e.prev=58,!w){e.next=61;break}throw x;case 61:return e.finish(58);case 62:return e.finish(55);case 63:attemptNextActionFromQueue(r);case 64:case"end":return e.stop()}},e,this,[[8,12,16,24],[17,,19,23],[27,32,36,44],[37,,39,43],[47,51,55,63],[56,,58,62]])})),function(e){return t.apply(this,arguments)})}var n,H=function(e,t,r,n){var o=null,a=null;try{var i=e.handleAction(t,r,n);i instanceof c?(n=i.immediate,a=i.deferred):n=i}catch(e){if(!(e instanceof StoreError))throw e;o=e}return{state:n,error:o,deferred:a,store:e}},O=(n=r(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=null,e.prev=2,!t.deferred){e.next=7;break}return e.next=6,t.deferred();case 6:r=e.sent;case 7:e.next=16;break;case 9:if(e.prev=9,e.t0=e.catch(2),!(e.t0 instanceof StoreError)){e.next=15;break}n=e.t0,e.next=16;break;case 15:throw e.t0;case 16:return e.abrupt("return",{state:r,error:n,store:t.store});case 17:case"end":return e.stop()}},e,void 0,[[2,9]])})),function(e){return n.apply(this,arguments)}),s=new t;e.ActionResult=c,e.buildStore=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s,r=null,o={clean:null,dirty:null},a=[];return function(){function t(e){i(this,t),this.isStore=!0,o.clean=e,o.dirty=e}return u(t,[{key:"setKey",value:function(e){r=e}},{key:"key",value:function(){return r}},{key:"setState",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return o[t?"clean":"dirty"]=e,t&&(o.dirty=e),{}[this.key()]=o.dirty,r?this.triggerStateChange():[]}},{key:"state",value:function(){return o[0<arguments.length&&void 0!==arguments[0]&&arguments[0]?"clean":"dirty"]}},{key:"triggerStateChange",value:function(){return Promise.all(a.map(function(t){return new Promise(function(e){return t.setState(toMerge,e)})}))}},{key:"dispatcher",value:function(){return e}},{key:"canHandleAction",value:function(e){return n.hasOwnProperty(e)}},{key:"handleAction",value:function(e,t,r){return n[e].call(this,r,t)}},{key:"connectToState",value:function(t,e){if(a.some(function(e){return e.key===t}))throw new Error("component (key="+t+") is already listening to the store (key="+this.key()+")");a.push({key:t,setState:e})}}]),t}()},e.d=s,e.Dispatcher=t,e.init=function(e){for(var t in e){var r=e[t];r.setKey(t),r.dispatcher().subscribe(r)}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=bundle.umd.js.map
