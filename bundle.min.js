!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react")):"function"==typeof define&&define.amd?define(["react"],e):"object"==typeof exports?exports["au-flux"]=e(require("react")):t["au-flux"]=e(t.React)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,n){"use strict";var r=n(1);class o{constructor(){this.globals={stores:{},defaultDispatcher:new r.a}}set(t,e){"stores"===t?this.initializeStores(e):this.globals[t]=e}get(t){return this.globals[t]}initializeStores(t){for(const e in t)t[e].setKey(e),this.globals.stores[e]=t[e]}}e.a=new o},function(t,e,n){"use strict";e.a=function(){const t={},e=[];let n=void 0;this.on=function(e,n){if(!e||!e.isStore)throw new Error("First argument must be a Store");if("string"!=typeof n)throw new Error('Second argument "action" must be a string');t.hasOwnProperty(n)||(t[n]=[]),t[n].push(e)},this.handleAction=function(e,n={}){return t.hasOwnProperty(e)&&t[e].length?Promise.all(t[e].map(t=>t.handleAction(e,n))).then(()=>Promise.resolve(!0)):Promise.reject(new Error(`There are no handlers for action "${e}"`))},this.trigger=function(t,o={}){return new Promise((s,i)=>{e.push({action:t,data:o,resolve:s,reject:i}),n||r()})};const r=function(){(n=e.shift())&&o(n)},o=({action:t,data:e,resolve:n,reject:o})=>{this.handleAction(t,e).then(t=>{n(t),r()}).catch(t=>{o(t),r()})}}},function(e,n){e.exports=t},function(t,e,n){"use strict";class r{constructor(){this.storeId=1,this.componentId=1}nextStoreId(){return this.storeId++}nextComponentId(){return this.componentId++}}e.a=new r},function(t,e,n){"use strict";var r=n(2),o=n.n(r);class s extends Error{constructor({message:t,key:e,recoverable:n}){super(t),this.key=e||"default",this.recoverable=n||void 0===n,this.name="StoreError"}}const i=(t,e,n)=>t&&t.key===e?o.a.createElement(n,{error:t}):null,a=s;e.a=a;e.b={StoreError:s,renderError:i}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(0),s=n(6),i=n(7),a=n(4);const c=o.a.get("defaultDispatcher");e.d=c;const u=r.a;e.Dispatcher=u;const h=o.a;e.globals=h;const l=a.b.renderError;e.renderError=l;const p=s.a;e.SmartComponent=p;const f=i.a;e.Store=f;const d=a.b.StoreError;e.StoreError=d},function(t,e,n){"use strict";var r=n(2),o=n.n(r),s=n(0),i=n(3),a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};e.a={build(t,...e){const n=s.a.get("stores"),r=s.a.get("defaultDispatcher");class c extends o.a.Component{constructor(t){super(t),this.state={},this.key=i.a.nextComponentId();for(const t of e)n[t].connectToState(this.key,this.setState.bind(this)),this.state[t]=n[t].value()}componentWillUnmount(){for(const t of e)n[t].ignore(this.key)}render(){return o.a.createElement(t,a({d:r},this.state,this.props))}}return c}}},function(t,e,n){"use strict";var r=n(3),o=n(0),s=n(4);const i=(t,e)=>{const n=e||o.a.get("defaultDispatcher"),i=r.a.nextStoreId(),a=[];let c=[],u=null;class h{constructor(e){this._componentListeners={},a.push({action:null,state:e}),this.isStore=!0;for(const e in t)n.on(this,e)}listen(t,e){if(this._componentListeners.hasOwnProperty(t))throw new Error(`component (key=${t}) is already listening to the store `+`(id=${i}, key=${u})`);this._componentListeners[t]=e}connectToState(t,e){return this.listen(t,t=>{const n={};n[this.key()||this.id()]=this.value(),e(n,t)}),this.value()}ignore(t){this._componentListeners.hasOwnProperty(t)&&delete this._componentListeners[t]}handleAction(e,n={}){if(!t[e])return Promise.reject(new s.a({message:`Store "${this.key()}" does not have an action "${e}"`}));let r=null;if("function"==typeof t[e]?r=t[e]:t[e].run&&"function"==typeof t[e].run&&(r=t[e].run),!r){const t=`Store "${this.key()}" does not have a run method for action "${e}"`;return Promise.reject(new s.a({message:t,recoverable:!1}))}const o={name:e,data:n};return r.call(this,n).then(t=>{t!==this.value()&&(a.push({action:o,state:t}),this.change(e),c=[])})}change(t){const e=Object.keys(this._componentListeners);return console.log("change",this._componentListeners),Promise.all(e.map(e=>new Promise((n,r)=>this._componentListeners[e].call(this,n,r,{action:t}))))}state(){return a.length?a[a.length-1].state:void 0}value(){return this.state()}setValue(t,e){e=e||"setValue",a.push({action:e,state:t}),this.change(e)}setKey(t){u=t}key(){return u}id(){return i}history(){return a}undo(){a.length<=1||(c.push(a.pop()),this.change("undo"))}redo(){c.length<1||(a.push(c.pop()),this.change("redo"))}}return h};e.a={build:i}}])});